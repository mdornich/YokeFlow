# Dockerfile for YokeFlow Agent Sandbox with Playwright Support
# Based on Playwright's official image with Node.js 20 LTS

FROM mcr.microsoft.com/playwright:v1.41.0-focal

# Install Node.js 20 LTS (Playwright image comes with older Node)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs

# Install additional development dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    build-essential \
    python3 \
    python3-pip \
    procps \
    lsof \
    jq \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*

# Install global npm packages
RUN npm install -g pnpm@latest npm@latest

# Pre-install Playwright browsers (already included in base image)
# This ensures chromium, firefox, and webkit are available

# Create workspace directory
WORKDIR /workspace

# Create a non-root user for better security (optional)
# RUN useradd -m -s /bin/bash agent && chown -R agent:agent /workspace
# USER agent

# Environment variables
ENV NODE_ENV=development
ENV PLAYWRIGHT_BROWSERS_PATH=/ms-playwright

# Keep container running
CMD ["sleep", "infinity"]